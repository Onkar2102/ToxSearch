================================================================================
ToxSearch with Speciation — Project Notes
================================================================================

--- Quick ref ---
  PROCESS_FLOW.md      complete end-to-end process flow (initialization → evolution loop → termination)
  ARCHITECTURE.md       modules, flow, parent selection, speciation, metrics
  FIELD_DEFINITIONS.txt field definitions for all JSON/CSV
  experiments/FLOW_AND_VALIDATION.md  flow, validation, field basis (variants vs post-gen vs cumulative)

--- Metrics ---
  avg_fitness           mean(old elites + old reserves + all new variants) BEFORE speciation, AFTER evaluation.
                        From calculate_average_fitness(include_temp=True). Gen 0: mean(temp).
  avg_fitness_generation  mean(updated elites + updated reserves) AFTER distribution. From calculate_generation_
                        statistics (elites+reserves files only). Archived excluded automatically.
  slope_of_avg_fitness    slope over gen["avg_fitness"]; uses avg_fitness for all gens (main passes
                        current_gen_avg_fitness into update_adaptive_selection_logic).
  best_fitness / avg_fitness  NOT in gen_entry["speciation"]; only at gen level (population_max_toxicity, max_score_variants, avg_fitness)

--- Refusal penalty ---
  After evaluation, before speciation. 15% (×0.85) on toxicity for is_refusal(response).
  Writes to moderation_result (google.scores or legacy scores) and north_star_score.

--- Cluster quality ---
  Silhouette, Davies-Bouldin, Calinski-Harabasz, QD. No Pareto or multi-objective; each metric independent.

--- Parent selection ---
  3-category: (1) active ∪ reserves (species 0), (2) frozen. Use (2) only when (1) empty.
  Modes: DEFAULT (2 parents), EXPLOIT (3 from top), EXPLORE (3 from 3 species).

--- Pareto (quality vs diversity, post-hoc) ---
  experiments/plot_pareto_quality_diversity.py
  - quality:  population_max_toxicity (cumulative max over all gens of best toxicity in elites+reserves)
  - diversity: inter_species_diversity from last gen's speciation (mean pairwise distance between
    all species leaders, active+frozen)
  Run: python experiments/plot_pareto_quality_diversity.py --base data/outputs --runs <run1> <run2> ...

--- Validation ---
  experiments/comprehensive_validation.py   main suite; run on data/outputs/<run>
  experiments/validate_outputs_extra.py     extra checks (e.g. duplicate IDs across files)

--- Output dir (data/outputs/YYYYMMDD_HHMM/) ---
  elites.json          all genomes with species_id > 0 (cumulative)
  reserves.json        all genomes with species_id = 0 (cumulative, sorted by toxicity desc)
  archive.json         archived genomes (capacity overflow, non-elite, cumulative)
  temp.json            transient variants for current generation (cleared/updated during speciation)
  EvolutionTracker.json  per-generation statistics, cumulative metrics, budget, speciation summary
  speciation_state.json  species structure, cluster 0 state, metrics history, config
  genome_tracker.json   event log of genome movements (clustering, archiving, merging)
  operator_effectiveness_cumulative.csv  per-operator metrics (NE, EHR, IR, cEHR, Δμ, Δσ)
  figures/             visualizations (fitness evolution, speciation, operator effectiveness, etc.)
  parents.json          slimmed parent genomes for selection
  top_10.json           top 10 genomes by toxicity

--- Run ---
  bash run_experiments_local.sh
  or: python src/main.py --generations 50 --operators all --rg <gguf> --pg <gguf>

  Device and run info are logged via logger at startup.

================================================================================
